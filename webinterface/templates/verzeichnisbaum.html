<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Radio Pi – Verzeichnis-Browser</title>
    <style>
body {
    margin: 0;
    background-color: #f4f4f4;
    font-family: sans-serif;

    display: flex;
    flex-direction: column;
    height: 100vh;
}
		
#folders button {
    background: none;
    border: none;
    padding: 0;
    cursor: pointer;

    display: flex;
    flex-direction: column;
    align-items: center;
}
		
#folders button span {
    margin-top: 6px;
    font-size: 14px;
    width: 100%;
    text-align: center;

    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

#folders button img {
	width: 100%;            /* füllt Button-Breite */
    max-width: 330px;       /* LP-Größe */
    /*height: auto;         	 Seitenverhältnis behalten */
    aspect-ratio: 1 / 1;    /* quadratisch wie LP */
    object-fit: cover;

    border-radius: 6px;
    /*display: block;*/
}
		
pre {
	background: #eee;
	padding: 10px;
	border-radius: 6px;
}
		
.topbar {
	display: flex;
	justify-content: space-between;
	align-items: center;
	padding: 10px 20px;
	background: white;
	box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.icon-button {
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
}

#folders {
    flex: 1;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 20px;
    padding: 20px;
    overflow-y: auto;
}

</style>
    <script>
        let currentPath = "";

        async function loadFolders(path = "") {
            const safePath = (path === undefined || path === null || path === "undefined") ? "" : path;

            try {
                const resp = await fetch("/list-folders?path=" + encodeURIComponent(safePath));
                const data = await resp.json();

                if (data.error) {
                    document.getElementById("current").innerText = "Fehler: " + data.error;
                    document.getElementById("folders").innerHTML = "";
                    document.getElementById("files").innerHTML = "";
                    return;
                }

                currentPath = (data.path === "." || data.path === "/" || !data.path) ? "" : data.path;
                const absPath = "/home/hara/" + currentPath;
                document.getElementById("current").innerText = absPath;

                const folderDiv = document.getElementById("folders");
                folderDiv.innerHTML = "";

                // Hoch-Button
                if (currentPath !== "") {
                    const upBtn = document.createElement("button");
                    upBtn.innerText = "HOCH";
                    upBtn.onclick = () => {
                        const parts = currentPath.split("/").filter(Boolean);
                        parts.pop();
                        loadFolders(parts.join("/"));
                    };
                    folderDiv.appendChild(upBtn);
                }

                // Ordner-Buttons
(data.folders || []).forEach(folder => {
    const fullPath = (currentPath ? currentPath + "/" : "") + folder;

    const btn = document.createElement("button");
    btn.onclick = () => loadFolders(fullPath);

    const img = document.createElement("img");
    img.src = "/cover?path=" + encodeURIComponent(fullPath);

    img.onerror = () => {
        btn.innerText = folder;   // fallback: Text anzeigen
    };

    btn.appendChild(img);
	// === Titel unter dem Bild ===
    const label = document.createElement("span");
    label.innerText = folder;

    btn.appendChild(label);
    // ============================
	
    folderDiv.appendChild(btn);
});


            } catch (err) {
                document.getElementById("current").innerText = "Fehler: " + err.message;
                document.getElementById("folders").innerHTML = "";
                document.getElementById("files").innerHTML = "";
            }
        }

        window.addEventListener("load", () => loadFolders(""));

		async function setEventListener() {
    const button = document.getElementById("play");
    button.addEventListener("click", async () => {
        if (!currentPath) {
            alert("Kein Verzeichnis gewählt!");
            return;
        }

        try {
            const resp = await fetch("/add-folder", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ path: currentPath })
            });
            const data = await resp.json();
            if (data.error) {
                alert("Fehler: " + data.error);
            } else {
                alert(data.output || "Ordner wurde hinzugefügt!");
            }
        } catch (err) {
            alert("Fehler: " + err.message);
        }
    });
}
window.addEventListener("load", () => setEventListener());
		
		
    </script>
</head>
<body>

<div class="topbar">
    <button class="icon-button">
		<a href="/" class="icon-button">
    <img src="/Scripte/home.jpg" alt="HOME">
</a>
	</button>
    <span id="current"></span>
    <button id="play" class="icon-button">⏏</button>
</div>

<div id="folders"></div>

</body>

</html>
